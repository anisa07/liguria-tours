---
import IntlBaseLayout from "@/layouts/IntlBaseLayout.astro";
import Container from "@/components/layout/Container.astro";
import Section from "@/components/layout/Section.astro";
import CallToAction from "@/components/content/CallToAction.astro";
import { getPageTranslations } from "@/i18n/i18n";
import type { Locale } from "@/i18n/config";
import { getCollection } from "astro:content";

// Set locale to Russian
const locale: Locale = "ru";

// Get the translation function for this page
const { t } = await getPageTranslations(locale, ["common", "ui", "about"]);

// Load about me data from content collection
const aboutMeCollection = await getCollection("aboutMe");
const aboutMeData = aboutMeCollection && aboutMeCollection[0]?.data;

// Use content collection data or fallback
const cmsData = aboutMeData;

const cta = {
  title: cmsData.cta.title,
  description: cmsData.cta.description,
  actions: [
    {
      label: t("common.choose_tour", "Выбрать экскурсию"),
      href: "/#tours",
      variant: "primary" as const,
    },
    {
      label: t("common.contact_me", "Связаться со мной"),
      href: "/contact",
      variant: "outline" as const,
    },
  ],
};

const seoData = cmsData.seoData;

// Extract data for easier use in templates
const { guide, story, personalTouch } = cmsData;
---

<IntlBaseLayout
  locale={locale}
  pageNS={["common", "ui", "about"]}
  seo={{
    title: seoData.title,
    description: seoData.description,
  }}
>
  <!-- Hero Section -->
  <Container class="text-center pt-24">
    <!-- Profile Image -->
    <div class="mb-8">
      <div class="relative inline-block">
        <img
          src={guide.profileImage.src}
          alt={guide.alt}
          class="w-48 h-48 rounded-full object-cover mx-auto shadow-xl border-4 border-liguria-mint"
        />
      </div>
    </div>

    <!-- Introduction -->
    <div class="max-w-3xl mx-auto">
      <h1 class="text-4xl md:text-5xl font-bold mb-4">{guide.name}</h1>
      <h2 class="text-xl md:text-2xl text-primary font-semibold mb-6">
        {guide.title}
      </h2>
      <p class="text-lg text-muted-foreground leading-relaxed mb-8">
        {guide.introduction}
      </p>

      <div class="flex flex-wrap justify-center gap-4 mb-12">
        {
          guide.highlights.map((highlight: { label: string }) => (
            <div class="px-4 py-2 rounded-full bg-primary/20">
              <span class="text-sm font-medium text-foreground/80">
                {highlight.label}
              </span>
            </div>
          ))
        }
      </div>
    </div>
  </Container>

  <!-- My Story -->

  <Container class="py-16">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold text-center mb-12">Моя история</h2>

      <div class="prose prose-lg max-w-none text-foreground/80">
        {
          story.sections.map((item, index: number) => (
            <div
              class={`flex flex-col ${index === 1 ? "md:flex-row-reverse" : "md:flex-row"} gap-8 mb-12 items-center`}
            >
              <div class="flex-1">
                <h3 class="text-xl font-semibold text-foreground mb-4">
                  {item.title}
                </h3>
                <p class="text-justify">{item.content}</p>
              </div>
              <div class="flex-shrink-0">
                <img
                  src={item.image.src}
                  alt={item.alt}
                  class="w-80 h-60 object-cover rounded-2xl shadow-lg"
                />
              </div>
            </div>
          ))
        }

        <div class="text-center bg-primary/20 p-8 rounded-2xl">
          <blockquote class="text-xl italic text-foreground">
            "{personalTouch.citation}"
          </blockquote>
          <cite class="block mt-4 text-foreground/80">- Светлана Жукова</cite>
        </div>
      </div>
    </div>
  </Container>

  <!-- Personal Touch -->

  <Container class="py-16">
    <div class="max-w-4xl mx-auto">
      <h2 class="text-3xl font-bold text-center mb-12">
        {personalTouch.title}
      </h2>

      <div class="grid md:grid-cols-2 gap-12">
        <div>
          <h3 class="text-xl font-semibold mb-6">
            {personalTouch.interests.title}
          </h3>
          <div class="space-y-3">
            {
              personalTouch.interests.items.map((interest: string) => (
                <div class="flex items-center gap-3">
                  <div class="w-2 h-2 bg-liguria-mint rounded-full" />
                  <span class="text-muted-foreground">{interest}</span>
                </div>
              ))
            }
          </div>
        </div>

        <div>
          <h3 class="text-xl font-semibold mb-6">
            {personalTouch.philosophy.title}
          </h3>
          <div class="space-y-4 text-muted-foreground">
            {
              personalTouch.philosophy.paragraphs.map((paragraph: string) => (
                <p>{paragraph}</p>
              ))
            }
          </div>
        </div>
      </div>
    </div>
  </Container>

  <!-- Call to Action -->
  <CallToAction
    title={cta.title}
    description={cta.description}
    actions={cta.actions}
    variant="centered"
    backgroundColor="primary"
    size="sm"
  />
</IntlBaseLayout>
